<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Triggering Activity Events | Building Real-Time Laravel Apps with Pusher</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.2.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    
        <link rel="stylesheet" href="../assets/styles/website.css">
    

        
    
    
    <link rel="next" href="../chat/index.html" />
    
    
    <link rel="prev" href="../activity-streams/simple-auth.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="4.2" data-basepath=".." data-revision="Wed Aug 19 2015 17:02:54 GMT+0100 (BST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        About this Workshop
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="introduction/what-is-pusher.html">
            
                
                    <a href="../introduction/what-is-pusher.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        What is Pusher?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction/pusher-use-cases.html">
            
                
                    <a href="../introduction/pusher-use-cases.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        (WiP) Pusher Use Cases
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="getting-started/index.html">
            
                
                    <a href="../getting-started/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Getting Started
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="getting-started/sign-up.html">
            
                
                    <a href="../getting-started/sign-up.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Sign up for Pusher
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="getting-started/laravel-app.html">
            
                
                    <a href="../getting-started/laravel-app.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Laravel App Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="getting-started/setting-env-vars.html">
            
                
                    <a href="../getting-started/setting-env-vars.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Setting Environment Variables
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="getting-started/laravel-pusher-bridge.html">
            
                
                    <a href="../getting-started/laravel-pusher-bridge.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Laravel Pusher Bridge
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="getting-started/event-broadcaster.html">
            
                
                    <a href="../getting-started/event-broadcaster.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Pusher Event Broadcaster
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="getting-started/bridge-v-broadcaster.html">
            
                
                    <a href="../getting-started/bridge-v-broadcaster.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Bridge v Broadcaster
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="getting-started/server-debugging.html">
            
                
                    <a href="../getting-started/server-debugging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Debugging Server-Side Integration with Pusher
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="getting-started/pusher-js-integration.html">
            
                
                    <a href="../getting-started/pusher-js-integration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        Using the Pusher JavaScript library
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="getting-started/pusher-js-debugging.html">
            
                
                    <a href="../getting-started/pusher-js-debugging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        Debugging with the Pusher JavaScript library
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="notifications/index.html">
            
                
                    <a href="../notifications/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Real-Time Notifications
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="notifications/fundamentals.html">
            
                
                    <a href="../notifications/fundamentals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Fundamentals
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="notifications/trigger.html">
            
                
                    <a href="../notifications/trigger.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Trigger a Notification Event
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="notifications/ui.html">
            
                
                    <a href="../notifications/ui.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Building the Notification UI
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="activity-streams/index.html">
            
                
                    <a href="../activity-streams/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Activity Streams
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="activity-streams/simple-auth.html">
            
                
                    <a href="../activity-streams/simple-auth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Super Simple Social Auth
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="4.2" data-path="activity-streams/activities.html">
            
                
                    <a href="../activity-streams/activities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Triggering Activity Events
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="chat/index.html">
            
                
                    <a href="../chat/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        (WiP) Chat
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="where-next/index.html">
            
                
                    <a href="../where-next/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        (WiP) What else can Pusher do?
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="where-next/resources.html">
            
                
                    <a href="../where-next/resources.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        (WiP) Resources
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Building Real-Time Laravel Apps with Pusher</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="triggering-activity-events">Triggering Activity Events</h2>
<p>We clearly don&apos;t have time to build a full social network. But we can support a few simple activities in order to demonstrate how events can be used to represent each activity type.</p>
<h2 id="create-the-controller-and-view">Create the Controller and View</h2>
<p><i class="fa fa-rocket fa-2"></i> Let&apos;s start by creating a plain controller:</p>
<pre><code>&#x203A; php artisan make:controller ActivityController --plain
</code></pre><p><i class="fa fa-rocket fa-2"></i> Update the controller using the code below:</p>
<pre><code class="lang-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">App</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivityController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">var</span> <span class="hljs-variable">$pusher</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;pusher = App::make(<span class="hljs-string">&apos;pusher&apos;</span>);
    }

    <span class="hljs-comment">/**
     * Serve the example activities view
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIndex</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: trigger event</span>
        <span class="hljs-keyword">return</span> view(<span class="hljs-string">&apos;activities&apos;</span>);
    }

    <span class="hljs-comment">/**
     * A new status update has been posted
     * <span class="hljs-doctag">@param</span> Request $request
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postStatusUpdate</span><span class="hljs-params">(Request <span class="hljs-variable">$request</span>)</span>
    </span>{
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: trigger event</span>
    }

    <span class="hljs-comment">/**
     * Like an activity
     * <span class="hljs-doctag">@param</span> $id The ID of the activity that has been liked
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLike</span><span class="hljs-params">(<span class="hljs-variable">$id</span>)</span>
    </span>{
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: trigger event</span>
    }
}
</code></pre>
<p><i class="fa fa-rocket fa-2"></i> And create a <code>resources/views/activities.blade.php</code> file and copy &amp; paste the contents of <a href="#">THIS TEMPLATE</a> into it.</p>
<p><i class="fa fa-rocket fa-2"></i> Finally, add an entry to your <code>app/Http/routes.php</code>:</p>
<pre><code class="lang-php">Route::controller(<span class="hljs-string">&apos;activities&apos;</span>, <span class="hljs-string">&apos;ActivityController&apos;</span>);
</code></pre>
<p>Now we want to trigger activity events.</p>
<h2 id="triggering-activity-events">Triggering Activity Events</h2>
<p>There are three potential types of activity in our <code>ActivityController</code>:</p>
<ol>
<li>A user visits the Activities page</li>
<li>A new status update has been posted</li>
<li>A status update has been &quot;liked&quot;</li>
</ol>
<p><i class="fa fa-rocket fa-2"></i> For each event (<code>user-visit</code>, <code>new-status-update</code> and <code>status-update-liked</code>) trigger an event on a <code>activities</code> channel. Each event should contain some <code>text</code> to display about the event and a unique <code>id</code>. Since we&apos;re not going to be using a database let&apos;s just use <code>str_random()</code> to generate a unique ID.</p>
<pre><code class="lang-php"><span class="hljs-variable">$data</span> = [<span class="hljs-string">&apos;text&apos;</span> =&gt; <span class="hljs-string">&apos;activity text&apos;</span>, `id` =&gt; <span class="hljs-string">&apos;a unique ID&apos;</span>];
</code></pre>
<p><i class="fa fa-rocket fa-2"></i> For the event that&apos;s triggered in the <code>postLike($id)</code> action also send the ID of the activity that the user liked on a <code>likedActivityId</code> property.</p>
<h2 id="building-the-activitystream-ui">Building the ActivityStream UI</h2>
<p>The view, defined in <code>resources/views/activities.blade.php</code>, already has some functionality, but you still need to hook up the real-time events.</p>
<h3 id="user-visited">User Visited</h3>
<p>Whenever the <code>/activities</code> endpoint (<code>getIndex()</code> action) is access a <code>user-visit</code> event is triggered on the <code>activities</code> channel. </p>
<p><i class="fa fa-rocket fa-2"></i> If you haven&apos;t already done so, navigate to <a href="http://localhost:8000/activites" target="_blank">http://localhost:8000/activites</a> endpoint in the browser and make sure the event is triggered by checking the Pusher Debug Console.</p>
<p><i class="fa fa-rocket fa-2"></i> Once you&apos;re sure the event is being triggered you can subscribe to the <code>activites</code> channel on the client and bind to the event. There&apos;s already a <code>addUserVisit</code> that can be used to handle the event and add an activity to the stream UI.</p>
<h3 id="status-updates">Status Updates</h3>
<p>Next we should handle the status updates that users can post from the view.</p>
<p><i class="fa fa-rocket fa-2"></i> Navigate to <a href="http://localhost:8000/activities" target="_blank">http://localhost:8000/activities</a> and make sure that entering some text into the &quot;What&apos;s your status?&quot; input and pressing <code>enter</code> results in your <code>/activites/status-update</code> endpoint (<code>postStatusUpdate(Request $request)</code> action) being called. You can check this in two ways:</p>
<ol>
<li>using the browser developer tools network tab</li>
<li>via the Pusher Debug Console</li>
</ol>
<p><i class="fa fa-rocket fa-2"></i> Once you know the status updates are hitting your endpoint and resulting in an event being triggered via Pusher you can bind to the <code>new-status-update</code> event. There&apos;s already a <code>addStatusUpdate</code> function that you can use to handle the event.</p>
<h3 id="likes">Likes</h3>
<p>Once you have status updates coming in you&apos;ll see that each activity has a small <span style="color:red;">&#x2665;</span> (heart) icon that can be clicked. When it&apos;s clicked the <code>sendLike</code> function is called sending down the activity ID. This results in the <code>/activities/like</code> endpoint (<code>postLike($id)</code>) being called and the <code>status-update-liked</code> event being triggered on the <code>activities</code> channel.</p>
<p><i class="fa fa-rocket fa-2"></i> Make sure that clicking the <span style="color:red;">&#x2665;</span> (heart) icon does what it&apos;s supposed to - you know the drill!</p>
<p>Finally we want to wire up the incoming <code>status-update-liked</code> and update the UI. </p>
<p><i class="fa fa-rocket fa-2"></i> This one hasn&apos;t been implemented for you. Here are the steps to help:</p>
<ul>
<li>Bind to the event and create a callback handler</li>
<li>Use the <code>addActivity(type, data)</code> function to add an activity stream element</li>
<li><em>Stretch Task:</em> Identify the element for activity that&apos;s been liked via the <code>data.likedActivityId</code> value and add a &quot;Liked Count&quot; value to the element with the class <code>.like-count</code> indicating the number of times that activity has been liked</li>
</ul>
<p>Once complete it should look at little bit like this:</p>
<p><img src="../assets/img/activity-streams-screenshot.png" alt="Activity Streams workshop example"></p>
<h2 id="what-s-next">What&apos;s next?</h2>
<p>We&apos;ve built real-time notification and activity streams. Next, it&apos;s the 101 or real-time technology where we can take everything we&apos;ve learned and <a href="../chat">build real-time chat</a>.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../activity-streams/simple-auth.html" class="navigation navigation-prev " aria-label="Previous page: Super Simple Social Auth"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chat/index.html" class="navigation navigation-next " aria-label="Next page: (WiP) Chat"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
